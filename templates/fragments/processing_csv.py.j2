    def process_csv_file(self, file_path: str) -> list[dict]:
        """Process a CSV file into normalized usage records.

        Args:
            file_path: Path to the input CSV file.

        Returns:
            List of dicts with 'date', 'category', and 'cost' keys.
        """
        import csv
        from pathlib import Path

        path = Path(file_path)
        if not path.exists():
            raise FileNotFoundError(f"CSV file not found: {file_path}")

{% if enterprise_config and enterprise_config.csv_structure %}
        header_skip = {{ enterprise_config.csv_structure.header_rows_to_skip }}
        date_col = {{ enterprise_config.csv_structure.date_column }}
        date_format = "{{ enterprise_config.csv_structure.date_format }}"
        cost_categories = {{ enterprise_config.csv_structure.cost_categories }}
{% else %}
        header_skip = 0
        date_col = 0
        date_format = "%b %Y"
        cost_categories = {}
{% endif %}

        records = []
        with open(path, "r") as f:
            reader = csv.reader(f)
            # Skip header rows
            for _ in range(header_skip):
                next(reader, None)

            for row in reader:
                if not row or not row[date_col].strip():
                    continue

                from datetime import datetime
                try:
                    date = datetime.strptime(row[date_col].strip(), date_format)
                except ValueError:
                    continue

                for category, col_idx in cost_categories.items():
                    if col_idx < len(row):
                        raw_cost = row[col_idx].strip()
                        # Clean non-numeric characters
                        cleaned = "".join(c for c in raw_cost if c.isdigit() or c == ".")
                        cost = float(cleaned) if cleaned else 0.0
                        if cost > 0:
                            records.append({
                                "date": date.strftime("%Y-%m-%dT00:00:00Z"),
                                "category": category,
                                "cost": cost,
                            })

        return records
