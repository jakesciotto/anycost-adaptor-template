# Black Forest Labs (BFL) API Configuration
# Image generation API with credit-based billing

provider:
  name: "bfl"
  display_name: "Black Forest Labs"
  service_type: "ai-image-generation"

# API Configuration
api:
  base_url: "https://api.bfl.ai"
  auth_method: "api_key"
  rate_limit: "10"
  timeout: "30"

# Authentication Requirements
auth:
  required_env_vars:
    - "BFL_API_KEY"
  optional_env_vars: []

# Data Configuration
data:
  source_format: "json"
  time_field: "timestamp"
  cost_field: "cost"
  resource_field: "service"

# CBF (Common Billing Format) Field Mappings
cbf_mapping:
  # Required fields
  "time/usage_start": "snapshot_timestamp"
  "cost/cost": "credits_consumed * credit_to_usd"
  "bill/invoice_id": "f'bfl-{month}'"

  # Line item columns
  "lineitem/id": "f'bfl-{timestamp}'"
  "lineitem/type": "'Usage'"
  "lineitem/description": "'BFL API Credit Consumption'"
  "lineitem/cloud_provider": "'bfl'"

  # Resource columns
  "resource/id": "'bfl:image-generation'"
  "resource/service": "'image-generation'"
  "resource/account": "'default'"
  "resource/region": "'global'"
  "resource/usage_family": "'api-credits'"

  # Usage columns
  "usage/amount": "credits_consumed"
  "usage/units": "'credits'"

  # Additional cost columns
  "cost/discounted_cost": "credits_consumed * discounted_rate"
  "cost/amortized_cost": ""
  "cost/on_demand_cost": ""

# Dependencies
dependencies:
  - "requests>=2.28.0"
  - "python-dotenv>=0.19.0"

# BFL Specific Configuration
bfl_config:
  # CloudZero connection ID
  cloudzero_connection_id: ""

  # Pricing information (credits per model)
  model_pricing:
    flux_kontext_pro: 4
    flux_kontext_max: 8
    flux_1_1_pro: 4
    flux_1_1_ultra: 6
    flux_1_1_raw: 6
    flux_fill_pro: 5
    flux_canny_pro: 5
    flux_depth_pro: 5
    flux_dev: 2.5
    flux_pro_finetuned: 6
    flux_1_1_ultra_finetuned: 7

  # Pricing calculation
  credit_to_usd: 0.0  # Set your credit-to-USD rate
  discount_rate: 0.0  # Set your negotiated discount rate
  discounted_rate: 0.0  # Set your effective discounted rate per credit

  # Snapshot storage
  snapshot_file: "state/bfl_snapshots.csv"
