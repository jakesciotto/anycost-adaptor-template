# AnyCost Adaptor Generator -- Config Schema Reference
# Field names align with the CloudZero CBF spec:
# https://docs.cloudzero.com/docs/anycost-common-bill-format-cbf
# See config/examples/ for working examples of each adaptor class.

# ---- Required top-level sections ----

provider:                          # REQUIRED
  name: ""                         # Lowercase identifier (e.g. "bfl")
  display_name: ""                 # Human-readable (e.g. "Black Forest Labs")
  service_type: ""                 # Category (e.g. "ai-image-generation")

api:                               # REQUIRED
  base_url: ""                     # API base URL
  auth_method: ""                  # api_key | api_key_header | basic_auth | bearer_token | bearer_jwt | oauth2
  rate_limit: 10                   # Requests per second (default: 10)
  timeout: 30                      # Request timeout seconds (default: 30)
  endpoints: {}                    # Named endpoints (e.g. {me: "/me"})

auth:                              # REQUIRED
  required_env_vars: []            # List of required env var names
  optional_env_vars: []            # List of optional env var names

data:                              # OPTIONAL (has defaults)
  source_format: "json"            # json | csv
  input_method: "api"              # api | file_upload
  time_field: "timestamp"          # Field name for time data
  cost_field: "cost"               # Field name for cost data
  resource_field: "resource_id"    # Field name for resource identifier

cbf_mapping:                       # OPTIONAL (has defaults)
  # Required CBF fields
  cost_cost: ""                    # Cost expression (required)
  time_usage_start: ""             # ISO 8601 UTC timestamp (required)
  # Required when tags are present
  resource_id: ""                  # Unique resource identifier
  # Recommended
  resource_account: "default"      # Most specific account/project designation
  lineitem_type: "Usage"           # Usage | Tax | Support | Purchase | Credit
  resource_service: ""             # Cloud service category
  usage_amount: ""                 # Numeric consumption value
  usage_units: ""                  # Unit descriptor (e.g. "credits", "characters", "GB")
  # Optional -- dimensions
  bill_invoice_id: ""              # Unique bill identifier
  lineitem_description: ""         # Additional line item info
  lineitem_cloud_provider: ""      # Provider identifier
  resource_region: "global"        # Geographic region (free-form)
  resource_usage_family: ""        # Subdivision of service category
  action_operation: ""             # Action performed on the resource
  action_usage_type: ""            # Subdivision of usage family
  # Optional -- cost variants (omitted from output if empty)
  cost_discounted_cost: ""         # Net cost after discounts/credits
  cost_amortized_cost: ""          # Effective cost after committed use amortization
  cost_discounted_amortized_cost: "" # Net effective cost with both discounts and amortization
  cost_on_demand_cost: ""          # Cost without any reductions
  # Optional -- Kubernetes (omitted from output if empty)
  k8s_cluster: ""                  # Kubernetes cluster name
  k8s_namespace: ""                # Kubernetes namespace
  k8s_deployment: ""               # Kubernetes deployment
  k8s_labels: ""                   # Kubernetes labels (JSON string)
  # Optional -- custom resource tags
  # Emitted as resource/tag:<key> columns. resource/id must be unique per tag combination.
  resource_tags: {}                # {tag_name: "source_field_name", ...}

dependencies: []                   # Pip packages (default: requests, python-dotenv)

# ---- Adaptor class selection ----
# Set explicitly or auto-detected from which class-specific section is present.
adaptor_class: ""                  # class1_credit | class2_structured | class3_enterprise | (auto)

# ---- Class 1: Credit Polling ----
credit_config:
  credits_endpoint: ""             # API endpoint to poll for credit balance
  credit_to_usd: 0.0              # Dollars per credit
  discount_rate: 0.0               # Discount percentage (0-1)
  discounted_rate: 0.0             # Post-discount rate per credit
  token_pools: []                  # [{field: "fieldName", label: "Label"}, ...]
  contract_value_usd: 0            # Contract total (informational)
  contract_start: ""               # Contract start date
  snapshot_file: ""                # Path to snapshot CSV
  model_pricing: {}                # Model-specific credit pricing

# ---- Class 2: Structured Billing ----
structured_config:
  root_data_key: "data"            # Key in API response containing data array
  line_type_field: ""              # Field identifying line item type
  field_mappings:
    cost: {}                       # {primary: "amount", alternate: "original_amount"}
    date: {}                       # {start: "start_date", end: "end_date"}
    resource: {}                   # {id: "resource.id", ...}
    usage: {}                      # {quantity: "quantity", unit: "unit"}
  tags: []                         # Fields to extract as resource/tag:<key> columns
  resource_id_template: ""         # Template for resource ID generation

# ---- Class 3: Enterprise ----
enterprise_config:
  csv_structure:                   # For CSV-based providers
    header_rows_to_skip: 0
    date_column: 0
    date_format: "%b %Y"
    cost_categories: {}            # {name: column_index, ...}
  nested_response: false           # For complex API responses
  pricing_rules: []                # [{name, contracted_count, below/above_contracted_price, cumulative_tracking}]
  fixed_costs: []                  # [{name, monthly_amount, valid_until, resource_id}]
  cost_categories: []              # List of cost category names
  aggregation_method: "daily"      # daily | monthly
  resource_id_templates: {}        # {app_level: "...", account_level: "..."}
  tags: []                         # Fields to extract as resource/tag:<key> columns
